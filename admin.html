<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>管理员登录 | 系统控制台</title>
		<link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
		<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
		<script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
		<link rel="stylesheet" href="admin.css">
	</head>
	<body>
		<div class="login-container">
			<div class="particles" id="particles"></div>

			<div class="brand-section">
				<i class="fas fa-lock brand-logo floating"></i>
				<h1 class="brand-title">影视资源</h1>
				<p class="brand-subtitle">安全、高效的管理系统，助您轻松掌控全局</p>
				<div class="copyright">
					&copy; 2025 宋溪 | 网盘管理后台 v2.0
				</div>
			</div>

			<div class="form-section">
				<div class="form-header">
					<h2>管理员登录</h2>
					<p>请输入您的账号信息以访问控制面板</p>
				</div>

				<div id="app">
					<el-form :model="form" size="medium">
						<el-form-item>
							<el-input v-model="form.username" placeholder="请输入用户名" prefix-icon="User"></el-input>
						</el-form-item>

						<el-form-item>
							<el-input type="password" v-model="form.password" placeholder="请输入密码" prefix-icon="Lock"
								show-password></el-input>
						</el-form-item>

						<div class="remember-forgot">
							<el-checkbox v-model="rememberMe">记住密码</el-checkbox>
							<a href="#" class="forgot-password">忘记密码?</a>
						</div>

						<el-form-item>
							<el-button type="primary" @click="login" style="width:100%;" :loading="loading">
								{{ loading ? '登录中...' : '登录系统' }}
							</el-button>
						</el-form-item>
					</el-form>

					<div class="additional-options">
						<p>其他登录方式:
							<a href="#"><i class="fab fa-weixin"></i> 微信</a> |
							<a href="#"><i class="fab fa-google"></i> Google</a> |
							<a href="#"><i class="fas fa-fingerprint"></i> 生物识别</a>
						</p>
					</div>
				</div>
			</div>
		</div>

		<script>
			const {
				createApp
			} = Vue;
			const {
				ElMessage
			} = ElementPlus;

			// 创建粒子背景
			function createParticles() {
				const container = document.getElementById('particles');
				const particleCount = 30;

				for (let i = 0; i < particleCount; i++) {
					const particle = document.createElement('div');
					particle.classList.add('particle');

					// 随机属性
					const size = Math.random() * 5 + 2;
					const left = Math.random() * 100;
					const duration = Math.random() * 20 + 10;
					const delay = Math.random() * 5;
					const opacity = Math.random() * 0.5 + 0.1;

					particle.style.width = `${size}px`;
					particle.style.height = `${size}px`;
					particle.style.left = `${left}%`;
					particle.style.animationDuration = `${duration}s`;
					particle.style.animationDelay = `${delay}s`;
					particle.style.opacity = opacity;

					container.appendChild(particle);
				}
			}

			createApp({
				data() {
					return {
						form: {
							username: '',
							password: ''
						},
						rememberMe: false,
						loading: false
					}
				},
				mounted() {
					createParticles();

					// 检查是否有保存的用户名
					if (localStorage.getItem('rememberedUsername')) {
						this.form.username = localStorage.getItem('rememberedUsername');
						this.rememberMe = true;
					}
				},
				methods: {
					async login() {
					    try {
					        // 1. 发送登录请求
					        const response = await fetch("http://localhost:8080/api/admin/login", {
					            method: "POST",
					            headers: {
					                "Content-Type": "application/json"
					            },
					            body: JSON.stringify(this.form)
					        });
					
					        const resData = await response.json();
					
					        // 2. 登录成功，存 token
					        if (resData.code === 200) {
					            ElMessage.success("登录成功");
					
					            // 注意这里存 token，不存整个 data 对象
					            localStorage.setItem("token", resData.token);
					
					            // 跳转到后台首页
					            window.location.href = "aindex.html";
					        } else {
					            ElMessage.error(resData.message || "登录失败");
					        }
					    } catch (error) {
					        ElMessage.error("登录失败: " + error.message);
					    }
					}


				}
			}).use(ElementPlus).mount("#app");
		</script>
	</body>

</html>
